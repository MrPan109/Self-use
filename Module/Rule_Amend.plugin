#!name = 规则修正v3.3.1
#!desc = 主修正和防暴力请求(带策略选择)
#!author = Mr.Pan
#!homepage = https://raw.githubusercontent.com/MrPan109/Self-use/master/Module/Rule_Amend.plugin
#!icon = https://raw.githubusercontent.com/Orz-3/mini/master/Color/Static.png
#!Date = 2025.03.21
#!category=基础

[Rule]
# > 修正规则
AND,((NOT,((SUBNET,SSID:MyHome))), (IP-CIDR,172.16.16.254/32,no-resolve)),BTP.03 // AX86U(内)
AND,((NOT,((GEOIP,CN,no-resolve))), (HOSTNAME-TYPE,IPv6)),REJECT-DROP // 干掉非国内V6
RULE-SET,RDs,REJECT-DROP,extended-matching,pre-matching
RULE-SET,RNDs,REJECT-NO-DROP,extended-matching,pre-matching,no-resolve
PROTOCOL,STUN,REJECT-DROP // 干掉所有STUN
RULE-SET,PDirect,DIRECT,extended-matching
#
[Ruleset RDs]
DOMAIN-WILDCARD,stun*.bilibili.com // 干掉B站STUN
DOMAIN-SUFFIX,null
DOMAIN-SUFFIX,undefined
DOMAIN-SUFFIX,geo2.adobe.com
DOMAIN-SUFFIX,in.applicationinsights.azure.com
DOMAIN,adservice.sigmob.cn  // 大师兄广告
#
[Ruleset RNDs]
DOMAIN,www.asusrouter.com // 防止访问路由器卡顿
DOMAIN-SUFFIX,mcdn.bilivideo.cn
DOMAIN-SUFFIX,p2p.huya.com
#
[Ruleset PDirect]
DOMAIN,wawj0109.iok.la // AX86U(外)
DOMAIN-SUFFIX,huawei.cn // welink
DOMAIN-SUFFIX,huawei.com // welink
DOMAIN-WILDCARD,ap?.agora.io // welink 
DOMAIN-WILDCARD,ap?-tls.agora.io // welink
AND,((DEST-PORT,8130), (PROTOCOL,UDP)) // welink
#
#
[General]
# > 跳过代理
skip-proxy = %INSERT% *.cd120.info, localhost, *.local, captive.apple.com, e.crashlytics.com, www.baidu.com, passenger.t3go.cn, yunbusiness.ccb.com, wxh.wo.cn, gate.lagou.com, www.abchina.com.cn, login-service.mobile-bank.psbc.com, mobile-bank.psbc.com, 10.0.0.0/8, 127.0.0.1/32, 172.16.0.0/12, 192.168.0.0/16, 192.168.122.1/32, 193.168.0.1/32, ::1/128, fe80::/10
#
# > Always Real IP Hosts
# 当 Surge VIF 处理 DNS 问题时，此选项要求 Surge 返回一个真正的 IP 地址，而不是一个假 IP 地址。
# DNS 数据包将被转发到上游 DNS 服务器。
always-real-ip = %INSERT% *.lan, *.direct, cable.auth.com, *.msftconnecttest.com, *.msftncsi.com, network-test.debian.org, detectportal.firefox.com, resolver1.opendns.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, stun.*, global.turn.twilio.com, global.stun.twilio.com, app.yinxiang.com, injections.adguard.org, local.adguard.org, localhost.*.qq.com, localhost.*.weixin.qq.com, *.logon.battlenet.com.cn, *.logon.battle.net, *.blzstatic.cn, music.163.com, *.music.163.com, *.126.net, musicapi.taihe.com, music.taihe.com, songsearch.kugou.com, trackercdn.kugou.com, *.kuwo.cn, api-jooxtt.sanook.com, api.joox.com, joox.com, y.qq.com, *.y.qq.com, streamoc.music.tc.qq.com, mobileoc.music.tc.qq.com, isure.stream.qqmusic.qq.com, dl.stream.qqmusic.qq.com, aqqmusic.tc.qq.com, amobile.music.tc.qq.com, *.xiami.com, *.music.migu.cn, music.migu.cn, proxy.golang.org, *.mcdn.bilivideo.cn, *.cmpassport.com, id6.me, open.e.189.cn, opencloud.wostore.cn, id.mail.wo.cn, mdn.open.wo.cn, hmrz.wo.cn, nishub1.10010.com, enrichgw.10010.com, *.wosms.cn, *.jegotrip.com.cn, *.icitymobile.mobi, *.pingan.com.cn, *.cmbchina.com, *.10099.com.cn, *.microdone.cn, pool.ntp.org, *.pool.ntp.org, ntp.*.com, time.*.com, ntp?.*.com, time?.*.com, time.*.gov, time.*.edu.cn, *.ntp.org.cn, PDC._msDCS.*.*, DC._msDCS.*.*, GC._msDCS.*.*
#
[MITM]
# 不可 MitM 也不应该被打断连接的域名。（修正腾讯视频不能下载）
hostname = %INSERT% -vv.video.qq.com -*.facebook.com, -*.instagram.com, -*.twitter.com, -*.snssdk.com, -*.pstatp.com
hostname-disabled = %INSERT% gateway.icloud.com, gateway.icloud.com.cn, weather-data.apple.com, buy.itunes.apple.com, ios.chat.openai.com